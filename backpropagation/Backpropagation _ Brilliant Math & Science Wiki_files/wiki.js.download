require=function i(t,n,e){function o(c,r){if(!n[c]){if(!t[c]){var d="function"==typeof require&&require;if(!r&&d)return d(c,!0);if(a)return a(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var s=n[c]={exports:{}};t[c][0].call(s.exports,function(i){var n=t[c][1][i];return o(n?n:i)},s,s.exports,i,t,n,e)}return n[c].exports}for(var a="function"==typeof require&&require,c=0;c<e.length;c++)o(e[c]);return o}({1:[function(i){var t=i("jquery"),n=i("app/generic_controllers");t(function(){n.initGenericControllers()})},{"app/generic_controllers":"app/generic_controllers",jquery:"jquery"}],"app/wiki":[function(i,t){var n,e,o,a=i("jquery"),c=i("underscore"),r=i("lib/wafer"),d=i("util/global"),l=i("util/ui"),s=i("app/content_modal"),u=i("util/sticky"),f=i("util/ajax"),m=i("util/latex"),h=i("util/autosave"),p=i("util/analytics"),g={},v=function(i){e||(e=a.id("outdated-wiki-modal")),c.defer(function(){i.find("textarea").on("input",c.once(function(){var t=i.data(),o=t.autosaveUser+"_"+t.autosaveKey,c=h.getEditHash(o),r=function(){a.get(t.hashUrl).then(function(i){i.summary_hash&&i.summary_hash!=c&&(e.modal(),h.discardEdit(o),clearTimeout(n))}),n=setTimeout(r,3e4)};r()}))}),e.find(".discard-btn").on("click",function(){window.location.reload()})},k=function(i){var t=i.parents("form"),e=t.find(".preview-button"),c=function(){t.hasClass("summary-text-editor")&&a(".wiki-main-column").removeClass("editing"),e.val(""),t.submit()};if(n){o||(o=a.id("save-outdated-wiki-modal")),clearTimeout(n);var r=i.data(),d=r.autosaveUser+"_"+r.autosaveKey,l=h.getEditHash(d);a.get(r.hashUrl).then(function(i){i.summary_hash&&i.summary_hash!=l?o.modal():c()}),o.find(".save-btn").on("click",c)}else c()},_=function(i){if(i.hasClass("stuck")){var t=i.parent();i.css({width:t.width(),left:t.offset().left-a.doc.scrollLeft(),margin:0})}else i.css({width:"",left:"",margin:""})};g.editSummary=function(i){var t;i.data("is-logged-out")?t=function(){a(".signup-modal").removeClass("hide")}:(t=function(){a(".wiki-main-column").addClass("editing");var i=a(".edit-summary-container").data();f(i.pageKey).get(i.url,{component_key:i.componentKey})},a(".summary").mathjax_update()),i.on("click",t)};var w=function(i,t){var n,e=30,o=30,a=[],c=!1,r=function(i){var t=0;return i.forEach(function(i){t+=i}),t/i.length};i.on("keydown.timecheck",function(){n=(new Date).getTime()}),i.on("input.timecheck",function(){if(n){var d=(new Date).getTime();if(a.length>=e&&a.shift(),a.push(d-n),!c&&a.length>=e){var l=r(a);l>=o&&(c=!0,i.off(".timecheck"),p.track("ui",{element_id:"input_timings_wiki",path:window.location.pathname,input_timing_avg:Math.round(l),input_timing_content_length:i.val().length,input_timing_form_type:t,input_timing_threshold:o}))}}})};g.editSummaryForm=function(i){var t=i.data(),n=t.isPreview,e=t.hasErrors,o=t.isUnchanged,c=a(".wiki-main-column"),r=a.id("summary_text_editor"),d=r.find(".button-container"),l=r.find("textarea"),s=a.id("summary_text_preview"),f=s.find(".button-container"),m=r.find(".preview-button"),h=r.find(".cancel-button"),p=s.find(".edit-button"),g=s.find(".save-button"),y=function(){l.autosize().wikiLinks(!0),u.stick(d,{bottom:d.offset().top+i.outerHeight(),handler:_}),w(l,"wiki_summary")},b=function(){a.window.scrollTop(0),s.mathjax_update(),setTimeout(function(){u.stick(f,{bottom:f.offset().top+i.outerHeight(),handler:_})},100),l.wikiLinks()};n||e||o?n?b():o&&c.removeClass("editing"):(y(),v(r)),m.on("click",function(){g.val("")}),h.on("click",function(){c.removeClass("editing")}),p.on("click",function(){i.addClass("editing"),a.window.scrollTop(0),y()}),g.on("click",function(){k(r)})},g.editSection=function(i){var t=i.data(),n=t.id,e=t.heading,o=a.id("wiki-sidebar"),r=a.id("section-"+n),d=r.find(".edit-section-container"),l=d.data(),s=a.id("edit-another-section-modal"),u=function(){if(r.length&&o.length){var i=o.offset().top+o.outerHeight();r.offset().top<i&&o.addClass("hide")}r.addClass("editing"),d.addClass("cmp_"+l.componentKey+"_id"),f(l.pageKey).get(l.url,{component_key:l.componentKey,heading:e})};i.on("click",function(){if(a(".cmp_wiki_canonical_edit_section_id").length){var i=a(".cmp_wiki_canonical_edit_section_id").find("#id_old_heading").val(),t=c.template(a.id("discard-changes-text").text());s.find(".modal-body").html(t({currentHeading:i,buttonHeading:e})),s.modal(),s.find(".discard-btn").on("click",function(){var i=a(".cmp_wiki_canonical_edit_section_id"),t=i.parent(".section"),n=t.prev(".skill-heading");i.removeClass("cmp_wiki_canonical_edit_section_id"),t.removeClass("editing"),n.removeClass("hide"),u()})}else u()})},g.editSectionForm=function(i){var t=i.data(),n=t.isPreview,e=t.isUnchanged,o=i.parents(".section"),a=o.prev(".skill-heading"),c=i.parent(".edit-section-container"),r=i.find(".section-text-editor"),d=i.children(".button-container"),l=r.find(".autosave-field"),s=r.find("textarea"),f=i.find(".section-preview"),m=f.find(".button-container"),h=i.find(".preview-button"),p=i.find(".cancel-button"),g=i.find(".edit-button"),y=i.find(".save-button"),b=function(){o.addClass("editing"),a.addClass("hide"),s.autosize().wikiLinks(!0),u.stick(d,{bottom:d.offset().top+i.outerHeight(),handler:_}),w(s,"wiki_section")},C=function(){f.mathjax_update(),setTimeout(function(){u.stick(m,{bottom:m.offset().top+i.outerHeight(),handler:_})},100),s.wikiLinks()},x=function(){c.removeClass("cmp_wiki_canonical_edit_section_id"),o.removeClass("editing"),a.removeClass("hide")};n||e?n?C():e&&x():(b(),v(l)),h.on("click",function(){y.val(""),i.removeClass("editing")}),p.on("click",function(){x()}),g.on("click",function(){i.addClass("editing"),s.autosize().wikiLinks(),u.stick(d,{bottom:d.offset().top+i.outerHeight(),handler:_})}),y.on("click",function(){k(l)})},g.expandOrCollapse=function(i){var t=i.find("header"),n=i.attr("id"),e=window.location.hash.substr(1);t.on("click",function(){var t=i.next(".section");i.hasClass("collapsed")?(i.removeClass("collapsed"),t.removeClass("collapsed"),m.checkOverflow(t)):(i.addClass("collapsed"),t.addClass("collapsed"))});var o=function(){t.trigger("click"),c.delay(function(){l.Anchors.scrollToTarget(t)},100)};d.is_mobile&&e===n&&o()},g.summary=function(i){i.find(".load-modal").each(function(){if(d.is_native){var i=a(this).find(".modal-link"),t=i.attr("href");t+=-1===t.indexOf("?")?"?":"&",t+="newwindow=true",i.attr("href",t).attr("target","")}else s.modal_events.apply(this,arguments),m.checkOverflow(a(this))});var t=a(".skill-heading");d.is_mobile&&1==t.length&&c.defer(function(){t.find("header").trigger("click")});var n=function(){var i=window.location.hash;"citation-"==i.substr(1,9)&&a.id(i.substr(1)).addClass("highlight-citation")};n(),a(".citation-link").on("click",function(){c.defer(n)})},g.rateWiki=function(i){var t=i.find("li"),n=i.data("rating"),e=!1;n?t.find("input[value="+n+"]").parents("li").addClass("selected"):t.on("click",function(){var n=a(this);e||(e=!0,t.find("input:checked").prop("checked",!1),n.addClass("selected"),n.find("input").prop("checked",!0),i.submit())})},g.reportDisputedWiki=function(i){var t=i.find("#submit");t.on("click",function(){i.submit(),a(".disputed-container").addClass("hide")})},g.confirmModeratorAction=function(i){i.on("click",function(){var t=i.data(),n=a("#"+t.logId),e=a("#wiki-logs-confirm").prop("checked");e?a.confirm(t.confirm_msg,function(e){e&&(n.val(t.value),i.parents("form").submit())}):(n.val(t.value),i.parents("form").submit())})},g.logsPager=function(i){i.on("click",function(){var t=i.data("page");a("#pagination_page_id").val(t),i.parents("form").submit()})},g.showStaffActions=function(i){var t=a(".wiki-staff-container"),n=a(".wiki-overlay");i.on("click",function(i){i.stopPropagation(),t.show(),n.show()}),a("body").on("click",function(){t.hide(),n.hide()}),t.on("click",function(i){i.stopPropagation()})},g.difficultySelector=function(i){var t=i.data();i.find("a").on("click",function(){var i=a(this).data("value");f(t.pageKey).get(t.url,{component_key:t.componentKey,community_post_difficulty:i})})},g.feedback=function(i){var t=a.id("wiki-feedback-trigger"),n="active",e=i.hasClass(n),o=function(t,o){e=!e,e&&(o!==!0&&l.Anchors.scrollToTarget(i),i.find(".cmp-deferred").each(function(){f.deferred.load(a(this))})),i.toggleClass(n,e)};t.on("click",o),-1!==window.location.hash.indexOf("feedback")&&o(null,!0)},g.getCitationTime=function(i){var t=c.template(a.id("retrieval-time-content").text()),n=new Date,e=["January","February","March","April","May","June","July","August","September","October","November","December"];i.find(".retrieval-time").html(t({hour:("0"+n.getHours()).slice(-2),minute:("0"+n.getMinutes()).slice(-2),month:e[n.getMonth()],day:n.getDate(),year:n.getFullYear()}))},g.wikiFooter=function(i){var t=a.id("footer").outerHeight();t&&c.defer(function(){var n=0;a.window.on("scroll",c.throttle(function(){var e=a.window.scrollTop()-(a.body.scrollHeight()-t-a.window.height());e>0?i.css({transform:"translate(0, -"+e+"px)"}):n>0&&i.css({transform:"translate(0, 0)"}),n=e},16))});var n=i.data("ax-id");n&&c.defer(function(){p.track("ui",{element_id:n,path:window.location.pathname,full_path:window.location.pathname+window.location.search})})},g.showSignUpModal=function(i){var t="numLoggedOutWikiViews",n=r.get(t),e=2,o=a.id("signup-modal-wiki"),d=function(){o.modal("show");var i=o.find(".public-signup-left");i.length&&!i.data("already-opened")&&(i.data("already-opened",!0),i.attr("data-already-opened",!0),p.track("ui",{element_id:"viewed_signup_login_modal_tour_slide_1"}))};n?(n++,r.set(t,n)):r.set(t,1),n>=e&&c.delay(d,3e3),i.find(".signup-btn").on("click",function(i){i.preventDefault(),d()})},g.examplesContribModal=function(i){i.modal()},t.exports=g},{"app/content_modal":"app/content_modal",jquery:"jquery","lib/wafer":"lib/wafer",underscore:"underscore","util/ajax":"util/ajax","util/analytics":"util/analytics","util/autosave":"util/autosave","util/global":"util/global","util/latex":"util/latex","util/sticky":"util/sticky","util/ui":"util/ui"}]},{},[1]);
//# sourceMappingURL=wiki.js.map
